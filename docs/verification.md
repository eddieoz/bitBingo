# BitBingo Verification Process

This document explains how anyone can independently verify the fairness and outcome of any bitBingo game using only public data and open-source logic.

## Reference Data for Verification

The following are valid, real data you can use to manually verify the process described in this document:

- **Valid Transaction ID:** `6a37d795e771aa88e9e9302dab8edecc9bacf7c77e18c822c6d249e8559fc002`
- **Valid CID:** `bafkreifu3wf3vqz4u7uktze6te2lxb57ekwrg3ngdjl4ktgoag5jfwudgi`
- **Valid Block hash:** `000000000000000000006f9367863b3fa7ecbc605c8215ef9e92386cbec8255f`
- **Valid Partial card winner:** Grace Lee
  - `10 22 39 46 64`
  - `7 23 42 49 71`
  - `11 20 FREE 59 61`
  - `4 19 38 50 74`
  - `8 26 35 58 65`
- **Valid Full card winner:** Eva Garcia
  - `6 18 38 51 67`
  - `7 27 44 58 74`
  - `15 16 FREE 46 62`
  - `5 24 40 52 64`
  - `3 26 36 49 66`
- **Valid drawn numbers:**
  - `I27 B15 O61 I28 I29 B10 N45 O74 O65 G51 N38 N43 B11 G55 N33 O68 N37 N34 B1 O71 N31 G56 B14 O67 N35 G48 G47 B3 B7 O66 O64 I30 I19 I23 G58 B4 I24 I26 G46 G60 I20 O72 N42 I25 O63 G54 B9 G53 N40 N44 N39 B5 N41 B8 G57 O70 O69 O75 N32 B6 G50 I18 G49 N36 G52 G59 I21 O62 I16`
- **Valid derivations:**
    - `m/44'/0'/0'/0/0`       `0221f19d6298f375ef4b2f829fbe479567d2a186aabef4f7790d7a73d32ff68145`
    - `m/44'/0'/0'/0/1`       `024942fcbb9b222a30c62e121438eba0153bfef15aa285ed3693d025523ef8897a`
    - `m/44'/0'/0'/0/2`       `030c03062f9ff15cfb9b355f470dfd45066e64a4e5ea2f03e41039fe4a07c21f80`
    - `m/44'/0'/0'/0/3`       `031ef24f30ffddfae19b6529ce51034a29a8a224cdcaab57d13114c3e4077cb686`
    - `m/44'/0'/0'/0/4`       `0281b9d9493eba7a42b2a701112aefed45216eff22141a36fceec0894afb6a5443`
    - `m/44'/0'/0'/0/5`       `03f1d762518e143589c605ae1bf80f292ce855834ada0e9857cef0d9abb9a5edbb`
    - `m/44'/0'/0'/0/6`       `030a2ae8b234e8d1d0cf57911ab2be604a3e450fa2ed1fab82f1fdf1258a70eb45`
    - `m/44'/0'/0'/0/7`       `02c934139df7611fcd14b33d03a034fdc7d17229daa7e226bb8dc963a123963abe`
    - `m/44'/0'/0'/0/8`       `0290eb5df27827e05a804abba54da3a431d2f6bc7de63de4ebda1c276390178c75`
    - `m/44'/0'/0'/0/9`       `03b2172ed0de54c28824d9a8dd27d59846269616b541f5d1f4df5254fd4639f0ee`
- **Valid CSV:** See `sample-tickets.csv` in the project root.

## Deterministic Game Logic

- **All randomness** (card generation, number draws) is derived from the Bitcoin block hash of the confirmed transaction anchoring the game.
- **BIP32 HD key derivation** is used with the block hash (SHA-256) as the seed, and the path `m/44'/0'/0'/0/{index}` for each card or draw.
- **Card grids** are generated from the derived public key (see below).
- **Drawn numbers** are generated by taking the last 4 bytes of the derived public key, converting to an integer, and mapping to 1–75.

## Card Generation Verification

1. **Obtain Inputs:**
   - The Bitcoin transaction ID (TXID) for the game.
   - The participant CSV (from IPFS, using the CID in the OP_RETURN of the TX).
   - The block hash of the block containing the TX (from any block explorer).
2. **Calculate the seed:**
   - Compute the SHA-256 hash of the block hash (hex string). This is the seed for BIP32.
3. **Find the participant's line index** in the CSV (0-based, after the header row).
4. **Derive the public key** using BIP32 with the seed and path `m/44'/0'/0'/0/{lineIndex}`.
5. **Generate the card grid:**
   - Convert the public key to hex.
   - Hash the hex string with SHA-256.
   - Use bytes from the hash to select unique numbers for each column (B: 1–15, I: 16–30, N: 31–45, G: 46–60, O: 61–75), skipping the center square (N[2], which is always free/null).
   - The card ID is `card-{last 8 hex characters of publicKeyHex}`.
6. **Compare** the generated card to the one shown in the app.

## Number Drawing Verification

1. **Obtain Inputs:**
   - The block hash (as above).
   - The sequence of drawn numbers (from the app or API).
2. **For each draw index (starting at 0):**
   - Derive the public key at path `m/44'/0'/0'/0/{drawIndex}`.
   - Take the last 4 bytes of the public key buffer, convert to a 32-bit unsigned integer (big endian).
   - Compute `(value % 75) + 1` to get the bingo number.
   - If the number is already drawn, increment the index and repeat until a unique number is found.
3. **Repeat** until the drawn sequence matches the app's output.

## Winner Verification

1. **Obtain the winner's card(s)** (as above).
2. **Obtain the drawn number sequence** (as above).
3. **Check for Bingo:**
   - A win requires 5 marked squares in a row, column, or diagonal (center is always free).
   - Compare the card grid and drawn numbers to confirm the win.

## Partial/Full Win Modes

- If the game is in partialAndFull mode, the game may end after a partial win (e.g., line bingo) or continue to full card.
- The API exposes the current state, including whether a partial win has occurred, who the winners are, and if the game is over.

## Tools for Manual Verification

- [Ian Coleman BIP39 Tool](https://iancoleman.io/bip39/):
  - Use the SHA-256 of the block hash as the BIP32 seed.
  - Set the derivation path as above.
  - Use the derived public key for card/number generation.
- Online hex-to-string and hash calculators for manual steps.

## Example

1. Get the TXID and block hash from a block explorer.
2. Get the participant CSV from IPFS (using the CID in the OP_RETURN output).
3. For a given player, find their line index, derive their card, and verify the grid.
4. For number draws, derive each public key, compute the number, and verify the sequence.

## See Also
- [docs/how-to-use.md](how-to-use.md) for user/admin workflow
- [server/utils.js](../server/utils.js) for the exact implementation logic 